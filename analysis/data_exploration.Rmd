---
title: "Cas confirmé par date, age, sex et province"
author: "GE"
date: "4/19/2020"
output:
  html_document:
    df_print: paged
---

```{r setup, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
SciViews::R
```

# Introduction 

Ce document a pour objectif de découvrir les données mises à disposition par Epistat. Un codebook est mis à disposition par Epistat afin de comprendre les variables <https://epistat.sciensano.be/COVID19BE_codebook.pdf> . 

J'ai pris la décision de ne traiter dans un premier temps que les cas dans le milieu hospitalier. En effet, l'ensemble de la population n'est pas testée donc il n'est pas envisageable de présenter des chiffres biasés. Les chiffres dans le milieu hospitalier me semble être les plus intéressant disponible actuellement.

Je pars donc du postulat que les personnes qui sont fortement touchées par cette maladie seront admises à l'hopital pour être traitée. 

```{r}
# lien vers les données
hospi_url <- "https://epistat.sciensano.be/Data/COVID19BE_HOSP.csv"
```

Ce document veut simplement présenter ma méthode personnelle lorsque je découvre un nouveau jeu de données.

# Importation des données et du du codebook 

Le fichier proposé est au format csv ce qui est un format standart d'importation que la fonction `read()` gère facilement.

```{r}
cas <- read(hospi_url)
```

La fonction str() propose une première vue des données. On retrouve le nombre d'observations, le nombre de variables, le type des variables,...

```{r}
str(cas)
```

Le codebook mis en place par Epistat doit nous permettre de comprendre les variables. Il est disponible via le lien suivant :  <https://epistat.sciensano.be/COVID19BE_codebook.pdf>. 

J'ai extrait les informations concernant notre tableau sur les hospitalisations par date et par province.

```{r}
read("../data/hospi_codebook.xlsx") %>.%
  DT::datatable(.)
```

> Je ne suis pas expert du domaine et ne suit pas sur de bien comprendre la différence entre les variables parlant du nombre de patients en soins intensifs, du nombre de patient sous respirateurs et du nombre de patients sous ECMO. 

# Noms des variables

J'ai pris l'habitude d'employer la convention typographique **snake case**. Le snake case va privilégier les mots en minuscule et séparé par des tirets bas. Il semble que Epistat utilise un variante du snake case avec l'ensemble des mots en majuscule. Par simplicité, je transforme tout en minuscule.

```{r}
cas %>.%
  rename_all(., str_to_lower) -> cas
```

# Type des variables

Avec la fonction `str()`, nous avons observé que la variables region et la variable province sont mal encodé. Elles sont encodé en caractères alors qu'elle devrait être encodée en facteur. 

Pour les provinces, nous avons les niveaux suivants : 

```{r}
unique(cas$province)
```

Pour les régions, nous avons les niveaux suivants :

```{r}
unique(cas$region)
```

Il est très important de vérifier les niveaux d'une variable qui va être convertie en variable de type facteur. Les niveaux des variables peuvent être changé au nécessaire. Il faut cependant faire attention que les niveaux soient pratiques. Cette étape peut être longue et fastidieuse mais elle est très importante.

```{r}
cas %>.% 
  mutate(., 
    province = fct_recode(
      stringi::stri_trans_general(province, "ASCII-Latin"), 
      "anvers" = "Antwerpen",
      "bruxelles" = "Brussels",
      "limbourg" = "Limburg",
      "liege" = "Li�ge",
      "flandre_orientale" = "OostVlaanderen",
      "brabant_wallon" = "BrabantWallon",
      "brabant_flamand" = "VlaamsBrabant",
      "flandre_occidentale" = "WestVlaanderen"),
    region = fct_recode(region,
      "flamande" = "Flanders",
      "bruxelles_capitale" = "Brussels",
      "wallonne" = "Wallonia")
    ) -> cas
```

# Découverte des données par des graphiques

```{r}
cas %>.%
  group_by(., date) %>.%
  summarise(.,
    total_in = sum(total_in, na.rm = TRUE),
    total_in_icu = sum(total_in_icu, na.rm = TRUE),
    total_in_resp = sum(total_in_resp, na.rm = TRUE),
    total_in_ecmo = sum(total_in_ecmo, na.rm = TRUE),
    new_in = sum(new_in, na.rm = TRUE),
    new_out = sum(new_out, na.rm = TRUE)
    ) -> cas_date

cas_date %>.%
  pivot_longer(., -date) -> t

chart(t, value ~ date %col=% name) +
  geom_line() +
  geom_point()
```


